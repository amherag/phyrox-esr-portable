os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.4
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: FTnriKzjl/jXmYmlrsxzGWxgH+eA/aXpAQyvfGy28eqBpVB/4W60bfO9bB5Lwi7s6SMpJGBW+2LIjeUvyROKw4yKcTUsOSFh2Q+zxonZJ1xGnXNBLc0xZ+kjMCsZ50kfU7h7R+b0Ct7ZMl2kkSM95ZwOxVztJK++QqLnelN74gSFI5EYPmLMyrI5b2k18wXnqwZ//StgbC9SfT10BrIZ7kCE+Mhlv55W2t9Ddz/1/ZznQIBtxFS3Hah3Kyxy4bi+ViB+lXuGLXN3V6FwHTYCg/VgPGNbpuslNWX34qEKOwmYM0FgnpP1FPWH9uzNhzbVlb3fa57Wu4mO54hWMSHAMksAwmxdJZ6ufQwQpB7EGDh7FFotApjBhQWPvNkMJL12uj2yj+I2FzdGD2JwV5fQ5yZ5Qd+iy6ZQsf0+83JWK06GHxiNmRBGWVvc1XLP1yejlU8QTuAU72LolRDx/LwfZesT+37TJLBNhnmcJh47FZ2aMZYdqnPA/xBfejyo2RqRu1UTWAkZqSHRWnwyhpu7BGnpjOIkZ+Dx42ng+Fwev6GQDbue1cxuIe7NJK5DwBdoFg8xDr2pS7MwCF3sf2sKkEqmq030EjaT/HQLCjznU6M+Dqpclvxg4kwZd+OxYpHQ4zKKRgcvaMLhuI0A4dRimtMBkFtqmTdBODNDd2r92Yo=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
